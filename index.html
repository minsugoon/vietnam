<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <title>ë² íŠ¸ë‚¨ ì—¬í–‰ ë²„íŠ¼ ëŒ€í™”</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{
      --bg:#0f0f12; --card:#17171c; --card2:#1f1f26; --text:#f5f5f7; --muted:#b9bbc6;
      --accent:#7dd3fc; --good:#34d399; --warn:#fbbf24; --danger:#fb7185;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:var(--bg); color:var(--text);
      -webkit-tap-highlight-color: transparent;
    }
    .app{
      min-height:100svh;
      display:flex; flex-direction:column;
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
      gap:10px;
    }
    header{
      display:flex; align-items:center; gap:10px;
      padding:10px 8px;
    }
    .title{
      font-size:20px; font-weight:800; letter-spacing:-0.3px;
      line-height:1.1;
    }
    .subtitle{font-size:13px;color:var(--muted);margin-top:2px}
    .header-right{margin-left:auto; display:flex; gap:8px; align-items:center;}
    .pill{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      padding:10px 12px; border-radius:999px;
      color:var(--text); font-weight:700; font-size:14px;
      display:flex; align-items:center; gap:8px;
    }
    .pill input{transform:scale(1.2)}
    .bar{
      display:flex; gap:8px; padding:0 6px 6px 6px;
    }
    .bar input{
      flex:1;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:999px;
      padding:14px 16px;
      font-size:16px;
      color:var(--text);
      outline:none;
    }
    .bar button{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:999px;
      padding:14px 16px;
      font-size:16px;
      color:var(--text);
      font-weight:800;
      min-width:92px;
    }

    .tabs{
      display:flex; gap:10px;
      overflow:auto;
      padding:6px;
      scroll-snap-type:x mandatory;
    }
    .tab{
      scroll-snap-align:start;
      flex:0 0 auto;
      display:flex; align-items:center; gap:8px;
      background:var(--card);
      border:1px solid rgba(255,255,255,0.10);
      padding:14px 14px;
      border-radius:999px;
      font-size:16px;
      font-weight:800;
      color:var(--text);
      user-select:none;
    }
    .tab.active{outline:2px solid rgba(125,211,252,0.5); border-color:rgba(125,211,252,0.5)}
    main{flex:1; display:flex; flex-direction:column; gap:10px; padding:0 6px 6px 6px;}
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media (min-width: 540px){
      .grid{grid-template-columns:1fr 1fr}
    }
    .btn{
      background:linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid rgba(255,255,255,0.12);
      border-radius:var(--radius);
      padding:18px 16px;
      text-align:left;
      color:var(--text);
      font-size:18px;
      font-weight:900;
      line-height:1.15;
      cursor:pointer;
      position:relative;
      min-height:68px;
    }
    .btn .hint{display:block; margin-top:8px; font-size:13px; color:var(--muted); font-weight:700}
    .btn:active{transform:translateY(1px)}
    .btn .star{
      position:absolute; right:12px; top:12px;
      width:44px; height:44px;
      display:grid; place-items:center;
      border-radius:12px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      font-size:20px;
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,0.62);
      display:none;
      align-items:center; justify-content:center;
      padding:12px;
      z-index:50;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(720px, 100%);
      background:linear-gradient(180deg, #15151a, #0f0f12);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:22px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.55);
    }
    .modal-header{
      display:flex; align-items:center; gap:10px;
      padding:12px 12px;
      background:rgba(255,255,255,0.05);
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .modal-header .kocat{
      font-weight:900; font-size:14px; color:var(--muted);
      letter-spacing:0.2px;
    }
    .modal-header .close{
      margin-left:auto;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:10px 12px;
      font-size:16px;
      font-weight:900;
      color:var(--text);
      min-width:76px;
    }
    .modal-body{padding:14px 14px 10px 14px; display:flex; flex-direction:column; gap:12px;}
    .card{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:18px;
      padding:14px;
    }
    .label{font-size:13px; color:var(--muted); font-weight:800; margin-bottom:8px}
    .ko{font-size:18px; font-weight:900; line-height:1.2}
    .vi{
      margin-top:10px;
      font-size:34px;
      font-weight:1000;
      line-height:1.15;
      letter-spacing:-0.2px;
    }
    .en{
      margin-top:8px;
      font-size:18px;
      font-weight:900;
      color:rgba(245,245,247,0.92);
    }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .actions button{
      flex:1;
      min-width:120px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:14px 14px;
      font-size:16px;
      font-weight:1000;
      color:var(--text);
    }
    .actions button.primary{outline:2px solid rgba(125,211,252,0.45); border-color:rgba(125,211,252,0.45)}
    .actions button.good{outline:2px solid rgba(52,211,153,0.40); border-color:rgba(52,211,153,0.35)}
    .actions button.danger{outline:2px solid rgba(251,113,133,0.35); border-color:rgba(251,113,133,0.35)}
    .note{font-size:12px;color:var(--muted);line-height:1.35}

    /* Show-to-others mode (super big) */
    .showmode .vi{font-size:54px}
    .showmode .en{font-size:22px}
    .showmode .ko{font-size:20px}
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(0,0,0,0.75);
      border:1px solid rgba(255,255,255,0.12);
      color:var(--text);
      padding:12px 14px;
      border-radius:999px;
      font-size:14px;
      font-weight:900;
      display:none;
      z-index:60;
    }
    .toast.show{display:block}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <div class="title">ë² íŠ¸ë‚¨ ì—¬í–‰ ë²„íŠ¼ ëŒ€í™”</div>
        <div class="subtitle">ë²„íŠ¼ì„ ëˆŒëŸ¬ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš” (ì˜¤í”„ë¼ì¸ ì§€ì›)</div>
      </div>
      <div class="header-right">
        <label class="pill" title="ìì£¼ ì“°ëŠ” ë¬¸ì¥ë§Œ ë³´ê¸°">
          â­ ì¦ê²¨ì°¾ê¸°
          <input id="onlyFav" type="checkbox" />
        </label>
        <label class="pill" title="ë¬¸ì¥ì„ ë” í¬ê²Œ ë³´ì—¬ì£¼ê¸°">
          ğŸ–¥ï¸ í¬ê²Œë³´ê¸°
          <input id="bigMode" type="checkbox" />
        </label>
      </div>
    </header>

    <div class="bar">
      <input id="search" type="search" placeholder="ì°¾ê¸° (ì˜ˆ: ê³µí•­, ë§¥ì£¼, ì–¼ë§ˆ)" inputmode="search" />
      <button id="clearSearch">ì§€ìš°ê¸°</button>
    </div>

    <div class="tabs" id="tabs"></div>

    <main>
      <div class="grid" id="grid"></div>
      <div class="note" style="padding:0 6px;">
        â€¢ ì‚¬ìš©ë²•: ë¬¸ì¥ ë²„íŠ¼ â†’ ë² íŠ¸ë‚¨ì–´ê°€ í¬ê²Œ ëœ¸ â†’ ìƒëŒ€ì—ê²Œ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”. ğŸ”ŠëŠ” ê¸°ê¸° ì§€ì› ì‹œë§Œ ì‘ë™í•©ë‹ˆë‹¤.
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div class="kocat" id="modalCat"></div>
        <button class="close" id="closeModal">ë‹«ê¸°</button>
      </div>
      <div class="modal-body" id="modalBody">
        <div class="card">
          <div class="label">í•œêµ­ì–´</div>
          <div class="ko" id="mKo"></div>
        </div>
        <div class="card" id="showCard">
          <div class="label">ë² íŠ¸ë‚¨ì–´ (ìƒëŒ€ì—ê²Œ ë³´ì—¬ì£¼ê¸°)</div>
          <div class="vi" id="mVi"></div>
          <div class="en" id="mEn"></div>
        </div>
        <div class="actions">
          <button class="good" id="toggleFav">â­ ì¦ê²¨ì°¾ê¸°</button>
          <button class="primary" id="speakVi">ğŸ”Š ë² íŠ¸ë‚¨ì–´ ì½ê¸°</button>
          <button id="copyAll">ğŸ“‹ ë³µì‚¬</button>
          <button class="danger" id="fullscreen">ğŸ”† í™”ë©´ ìµœëŒ€</button>
        </div>
        <div class="note" id="ttsNote"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const CATS = [
    { key:"fav", icon:"â­", name:"ì¦ê²¨ì°¾ê¸°" },
    { key:"greet", icon:"ğŸ‘‹", name:"ì¸ì‚¬" },
    { key:"basic", icon:"ğŸ§­", name:"ê¸°ë³¸" },
    { key:"airport", icon:"âœˆï¸", name:"ê³µí•­" },
    { key:"hotel", icon:"ğŸ¨", name:"ìˆ™ì†Œ/ì˜ˆì•½" },
    { key:"transport", icon:"ğŸš•", name:"êµí†µ" },
    { key:"food", icon:"ğŸœ", name:"ì‹ë‹¹" },
    { key:"money", icon:"ğŸ’³", name:"ê°€ê²©/ê²°ì œ" },
    { key:"help", icon:"ğŸ†˜", name:"ê¸´ê¸‰" },
  ];

  // ë¬¸ì¥ ë°ì´í„° (í•„ìš”ì‹œ ê³„ì† ì¶”ê°€ ê°€ëŠ¥)
  const PHRASES = [
    // ì¸ì‚¬
    {cat:"greet", ko:"ì•ˆë…•í•˜ì„¸ìš”.", vi:"Xin chÃ o.", en:"Hello."},
    {cat:"greet", ko:"ê°ì‚¬í•©ë‹ˆë‹¤.", vi:"Cáº£m Æ¡n.", en:"Thank you."},
    {cat:"greet", ko:"ì£„ì†¡í•©ë‹ˆë‹¤.", vi:"Xin lá»—i.", en:"Sorry / Excuse me."},
    {cat:"greet", ko:"ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”.", vi:"ChÃºc báº¡n má»™t ngÃ y tá»‘t lÃ nh.", en:"Have a nice day."},
    {cat:"greet", ko:"ë„ì™€ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.", vi:"Cáº£m Æ¡n báº¡n Ä‘Ã£ giÃºp tÃ´i.", en:"Thank you for helping me."},

    // ê¸°ë³¸
    {cat:"basic", ko:"í•œêµ­ ì‚¬ëŒì…ë‹ˆë‹¤.", vi:"TÃ´i lÃ  ngÆ°á»i HÃ n Quá»‘c.", en:"Iâ€™m Korean."},
    {cat:"basic", ko:"ì˜ì–´/ë² íŠ¸ë‚¨ì–´ë¥¼ ëª»í•©ë‹ˆë‹¤. ì²œì²œíˆ ë§í•´ ì£¼ì„¸ìš”.", vi:"TÃ´i khÃ´ng nÃ³i Ä‘Æ°á»£c tiáº¿ng Anh/tiáº¿ng Viá»‡t. Vui lÃ²ng nÃ³i cháº­m.", en:"I canâ€™t speak English/Vietnamese. Please speak slowly."},
    {cat:"basic", ko:"ë‹¤ì‹œ í•œ ë²ˆ ë§í•´ ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng nÃ³i láº¡i.", en:"Please say it again."},
    {cat:"basic", ko:"ì´ê±¸ë¡œ ê´œì°®ë‚˜ìš”?", vi:"NhÆ° váº­y Ä‘Æ°á»£c khÃ´ng?", en:"Is this okay?"},
    {cat:"basic", ko:"í™”ì¥ì‹¤ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"NhÃ  vá»‡ sinh á»Ÿ Ä‘Ã¢u?", en:"Where is the restroom?"},
    {cat:"basic", ko:"ì—¬ê¸° ì¢€ ë„ì™€ì£¼ì„¸ìš”.", vi:"GiÃºp tÃ´i vá»›i, lÃ m Æ¡n.", en:"Please help me here."},
    {cat:"basic", ko:"ì‚¬ì§„ ì°ì–´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", vi:"Báº¡n cÃ³ thá»ƒ chá»¥p áº£nh giÃºp tÃ´i khÃ´ng?", en:"Could you take a photo for me?"},
    {cat:"basic", ko:"ì´ ì£¼ì†Œë¡œ ê°€ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n Ä‘áº¿n Ä‘á»‹a chá»‰ nÃ y.", en:"I want to go to this address."},

    // ê³µí•­
    {cat:"airport", ko:"ì¶œêµ­ì¥(ì²´í¬ì¸)ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Khu lÃ m thá»§ tá»¥c (check-in) á»Ÿ Ä‘Ã¢u?", en:"Where is the check-in area?"},
    {cat:"airport", ko:"ìˆ˜í•˜ë¬¼ ì°¾ëŠ” ê³³ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Khu nháº­n hÃ nh lÃ½ á»Ÿ Ä‘Ã¢u?", en:"Where is baggage claim?"},
    {cat:"airport", ko:"í™˜ì „ì†ŒëŠ” ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Quáº§y Ä‘á»•i tiá»n á»Ÿ Ä‘Ã¢u?", en:"Where is the currency exchange?"},
    {cat:"airport", ko:"íƒì‹œ íƒ€ëŠ” ê³³ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Chá»— báº¯t taxi á»Ÿ Ä‘Ã¢u?", en:"Where can I get a taxi?"},
    {cat:"airport", ko:"ì´ í•­ê³µí¸ì´ ë§ë‚˜ìš”? í™•ì¸í•´ì£¼ì„¸ìš”.", vi:"ÄÃ¢y cÃ³ Ä‘Ãºng chuyáº¿n bay khÃ´ng? Vui lÃ²ng kiá»ƒm tra.", en:"Is this the right flight? Please check."},

    // ìˆ™ì†Œ/ì˜ˆì•½
    {cat:"hotel", ko:"ì˜ˆì•½í–ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ì£¼ì„¸ìš”.", vi:"TÃ´i Ä‘Ã£ Ä‘áº·t phÃ²ng. Vui lÃ²ng kiá»ƒm tra giÃºp tÃ´i.", en:"I have a reservation. Please check."},
    {cat:"hotel", ko:"ì²´í¬ì¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n lÃ m thá»§ tá»¥c nháº­n phÃ²ng.", en:"Iâ€™d like to check in."},
    {cat:"hotel", ko:"ì²´í¬ì•„ì›ƒí•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n tráº£ phÃ²ng.", en:"Iâ€™d like to check out."},
    {cat:"hotel", ko:"ë°© í‚¤ê°€ ì•ˆ ë©ë‹ˆë‹¤.", vi:"Tháº» phÃ²ng khÃ´ng dÃ¹ng Ä‘Æ°á»£c.", en:"The room key card doesnâ€™t work."},
    {cat:"hotel", ko:"ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ê°€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", vi:"Máº­t kháº©u Wi-Fi lÃ  gÃ¬?", en:"What is the Wi-Fi password?"},
    {cat:"hotel", ko:"ìˆ˜ê±´ì„ ë” ì£¼ì„¸ìš”.", vi:"Cho tÃ´i thÃªm khÄƒn táº¯m, lÃ m Æ¡n.", en:"Please give me more towels."},
    {cat:"hotel", ko:"ë°© ì²­ì†Œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.", vi:"Vui lÃ²ng dá»n phÃ²ng giÃºp tÃ´i.", en:"Please clean the room."},
    {cat:"hotel", ko:"ì—ì–´ì»¨ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", vi:"MÃ¡y láº¡nh khÃ´ng hoáº¡t Ä‘á»™ng.", en:"The air conditioner doesnâ€™t work."},

    // êµí†µ
    {cat:"transport", ko:"ê³µí•­ìœ¼ë¡œ ê°€ì£¼ì„¸ìš”.", vi:"LÃ m Æ¡n Ä‘Æ°a tÃ´i Ä‘áº¿n sÃ¢n bay.", en:"Please take me to the airport."},
    {cat:"transport", ko:"í˜¸í…”(ë¦¬ì¡°íŠ¸)ë¡œ ê°€ì£¼ì„¸ìš”.", vi:"LÃ m Æ¡n Ä‘Æ°a tÃ´i Ä‘áº¿n khÃ¡ch sáº¡n / khu nghá»‰ dÆ°á»¡ng.", en:"Please take me to the hotel / resort."},
    {cat:"transport", ko:"ì—¬ê¸°ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xuá»‘ng á»Ÿ Ä‘Ã¢y.", en:"Please drop me off here."},
    {cat:"transport", ko:"ì²œì²œíˆ ê°€ì£¼ì„¸ìš”.", vi:"Äi cháº­m thÃ´i.", en:"Please go slowly."},
    {cat:"transport", ko:"ë¯¸í„°ê¸°ë¥¼ ì¼œì£¼ì„¸ìš”.", vi:"Vui lÃ²ng báº­t Ä‘á»“ng há»“ tÃ­nh tiá»n.", en:"Please turn on the meter."},
    {cat:"transport", ko:"ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?", vi:"Máº¥t bao lÃ¢u?", en:"How long will it take?"},
    {cat:"transport", ko:"ì—¬ê¸°ê°€ ë§ë‚˜ìš”?", vi:"ÄÃºng chá»— nÃ y khÃ´ng?", en:"Is this the right place?"},
    {cat:"transport", ko:"ì •ì§€í•´ ì£¼ì„¸ìš”.", vi:"Dá»«ng láº¡i, lÃ m Æ¡n.", en:"Please stop."},

    // ì‹ë‹¹
    {cat:"food", ko:"ë©”ë‰´ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xem thá»±c Ä‘Æ¡n, lÃ m Æ¡n.", en:"Menu, please."},
    {cat:"food", ko:"ì´ê±° ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i mÃ³n nÃ y.", en:"Iâ€™d like to order this."},
    {cat:"food", ko:"ë¬¼ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i nÆ°á»›c, lÃ m Æ¡n.", en:"Water, please."},
    {cat:"food", ko:"ì½œë¼ë¥¼ ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i Coca.", en:"Iâ€™d like to order a Coke."},
    {cat:"food", ko:"ë§¥ì£¼ë¥¼ ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i bia.", en:"Iâ€™d like to order beer."},
    {cat:"food", ko:"ê³ ìˆ˜ë¥¼ ë¹¼ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng khÃ´ng cho rau mÃ¹i.", en:"Please donâ€™t add cilantro."},
    {cat:"food", ko:"ëœ ë§µê²Œ í•´ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng lÃ m Ã­t cay.", en:"Please make it less spicy."},
    {cat:"food", ko:"ë§¤ìš´ ê±° ë¹¼ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng khÃ´ng cho á»›t.", en:"Please donâ€™t add chili."},
    {cat:"food", ko:"ê³¼ì¼ì´ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ trÃ¡i cÃ¢y khÃ´ng?", en:"Do you have fruit?"},
    {cat:"food", ko:"ì±„ì‹ ë©”ë‰´ê°€ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ mÃ³n chay khÃ´ng?", en:"Do you have vegetarian food?"},
    {cat:"food", ko:"í¬ì¥í•´ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i mang vá», lÃ m Æ¡n.", en:"To go, please."},
    {cat:"food", ko:"ê³„ì‚°ì„œ ì£¼ì„¸ìš”.", vi:"TÃ­nh tiá»n, lÃ m Æ¡n.", en:"Bill, please."},
    {cat:"food", ko:"ì¹´ë“œë¡œ ê²°ì œí•  ìˆ˜ ìˆë‚˜ìš”?", vi:"TÃ´i cÃ³ thá»ƒ thanh toÃ¡n báº±ng tháº» khÃ´ng?", en:"Can I pay by card?"},
    {cat:"food", ko:"ê³ ì¶”ì¥ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ gochujang khÃ´ng?", en:"Do you have gochujang?"},

    // ê°€ê²©/ê²°ì œ
    {cat:"money", ko:"ì–¼ë§ˆì…ë‹ˆê¹Œ?", vi:"Bao nhiÃªu tiá»n?", en:"How much is it?"},
    {cat:"money", ko:"ì¢€ ê¹ì•„ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", vi:"Báº¡n cÃ³ thá»ƒ giáº£m giÃ¡ má»™t chÃºt khÃ´ng?", en:"Can you give me a discount?"},
    {cat:"money", ko:"ì´ê±° 2ê°œ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i 2 cÃ¡i nÃ y.", en:"Two of these, please."},
    {cat:"money", ko:"ì˜ìˆ˜ì¦ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xin hÃ³a Ä‘Æ¡n.", en:"Please give me a receipt."},
    {cat:"money", ko:"í˜„ê¸ˆìœ¼ë¡œ ê²°ì œí• ê²Œìš”.", vi:"TÃ´i sáº½ tráº£ báº±ng tiá»n máº·t.", en:"I will pay in cash."},
    {cat:"money", ko:"ì¹´ë“œë¡œ ê²°ì œí• ê²Œìš”.", vi:"TÃ´i sáº½ tráº£ báº±ng tháº».", en:"I will pay by card."},

    // ê¸´ê¸‰
    {cat:"help", ko:"ë„ì™€ì£¼ì„¸ìš”!", vi:"GiÃºp tÃ´i vá»›i!", en:"Help me!"},
    {cat:"help", ko:"ê¸¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤.", vi:"TÃ´i bá»‹ láº¡c.", en:"Iâ€™m lost."},
    {cat:"help", ko:"ê²½ì°°ì„ ë¶ˆëŸ¬ì£¼ì„¸ìš”.", vi:"Gá»i cáº£nh sÃ¡t giÃºp tÃ´i.", en:"Please call the police."},
    {cat:"help", ko:"ë³‘ì›ì— ê°€ì•¼ í•©ë‹ˆë‹¤.", vi:"TÃ´i cáº§n Ä‘áº¿n bá»‡nh viá»‡n.", en:"I need to go to the hospital."},
    {cat:"help", ko:"ì•½êµ­ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"NhÃ  thuá»‘c á»Ÿ Ä‘Ã¢u?", en:"Where is the pharmacy?"},
    {cat:"help", ko:"íœ´ëŒ€í°ì„ ìƒì–´ë²„ë ¸ìŠµë‹ˆë‹¤.", vi:"TÃ´i bá»‹ máº¥t Ä‘iá»‡n thoáº¡i.", en:"I lost my phone."},
  ];

  // ---- State ----
  const LS_FAV = "vn_btn_fav_v1";
  const LS_CAT = "vn_btn_cat_v1";
  const LS_BIG = "vn_btn_big_v1";
  const LS_ONLYFAV = "vn_btn_onlyfav_v1";

  let favorites = new Set(JSON.parse(localStorage.getItem(LS_FAV) || "[]"));
  let selectedCat = localStorage.getItem(LS_CAT) || "greet";
  let onlyFav = (localStorage.getItem(LS_ONLYFAV) || "0") === "1";
  let bigMode = (localStorage.getItem(LS_BIG) || "1") === "1"; // ê¸°ë³¸ ON ì¶”ì²œ
  let searchText = "";

  // Modal current
  let currentIdx = -1;

  // ---- UI refs ----
  const tabsEl = $("tabs");
  const gridEl = $("grid");
  const overlayEl = $("overlay");
  const mKo = $("mKo");
  const mVi = $("mVi");
  const mEn = $("mEn");
  const modalCat = $("modalCat");
  const closeModal = $("closeModal");
  const toggleFavBtn = $("toggleFav");
  const speakViBtn = $("speakVi");
  const copyAllBtn = $("copyAll");
  const fullscreenBtn = $("fullscreen");
  const ttsNote = $("ttsNote");
  const onlyFavEl = $("onlyFav");
  const bigModeEl = $("bigMode");
  const searchEl = $("search");
  const clearSearchEl = $("clearSearch");
  const toastEl = $("toast");
  const showCard = $("showCard");

  function vibrate(ms=20){
    if (navigator.vibrate) navigator.vibrate(ms);
  }

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1200);
  }

  function normalize(s){
    return (s||"").toLowerCase().replace(/\s+/g,"").trim();
  }

  function isFav(idx){ return favorites.has(String(idx)); }

  function toggleFav(idx){
    const key = String(idx);
    if (favorites.has(key)) favorites.delete(key);
    else favorites.add(key);
    localStorage.setItem(LS_FAV, JSON.stringify([...favorites]));
  }

  function renderTabs(){
    tabsEl.innerHTML = "";
    for (const c of CATS){
      const btn = document.createElement("button");
      btn.className = "tab" + ((c.key===selectedCat) ? " active" : "");
      btn.type = "button";
      btn.textContent = `${c.icon} ${c.name}`;
      btn.onclick = () => {
        vibrate();
        selectedCat = c.key;
        localStorage.setItem(LS_CAT, selectedCat);
        renderTabs();
        renderGrid();
      };
      tabsEl.appendChild(btn);
    }
  }

  function phraseMatches(p){
    if (!searchText) return true;
    const q = normalize(searchText);
    const hay = normalize(p.ko + " " + p.vi + " " + p.en);
    return hay.includes(q);
  }

  function getVisibleItems(){
    // ì¦ê²¨ì°¾ê¸° ì¹´í…Œê³ ë¦¬ëŠ” favoritesë§Œ
    if (selectedCat === "fav"){
      const out = [];
      PHRASES.forEach((p, i) => {
        if (isFav(i) && phraseMatches(p)) out.push({p, i});
      });
      return out;
    }

    const out = [];
    PHRASES.forEach((p, i) => {
      if (p.cat !== selectedCat) return;
      if (onlyFav && !isFav(i)) return;
      if (!phraseMatches(p)) return;
      out.push({p, i});
    });
    return out;
  }

  function renderGrid(){
    const items = getVisibleItems();
    gridEl.innerHTML = "";

    if (items.length === 0){
      const empty = document.createElement("div");
      empty.className = "card";
      empty.innerHTML = `<div class="ko" style="font-size:18px;">í‘œì‹œí•  ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      <div class="note" style="margin-top:8px;">â€¢ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê±°ë‚˜, ì°¾ê¸° ë‹¨ì–´ë¥¼ ì§€ì›Œë³´ì„¸ìš”.</div>`;
      gridEl.appendChild(empty);
      return;
    }

    for (const {p, i} of items){
      const b = document.createElement("button");
      b.className = "btn";
      b.type = "button";
      b.innerHTML = `
        <div>${p.ko}</div>
        <span class="hint">${p.vi}</span>
        <div class="star" title="ì¦ê²¨ì°¾ê¸°">${isFav(i) ? "â­" : "â˜†"}</div>
      `;

      // ë³„ ë²„íŠ¼ ì˜ì—­ í´ë¦­ ë¶„ë¦¬
      b.onclick = (ev) => {
        const starRect = b.querySelector(".star").getBoundingClientRect();
        const x = ev.clientX, y = ev.clientY;
        const isStarClick = x >= starRect.left && x <= starRect.right && y >= starRect.top && y <= starRect.bottom;

        vibrate();
        if (isStarClick){
          toggleFav(i);
          renderGrid();
          toast(isFav(i) ? "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" : "ì¦ê²¨ì°¾ê¸° í•´ì œ");
          return;
        }
        openModal(i);
      };

      gridEl.appendChild(b);
    }
  }

  function openModal(idx){
    currentIdx = idx;
    const p = PHRASES[idx];
    modalCat.textContent = "ì¹´í…Œê³ ë¦¬: " + (CATS.find(c=>c.key===p.cat)?.name || p.cat);

    mKo.textContent = p.ko;
    mVi.textContent = p.vi;
    mEn.textContent = p.en;

    // Big mode
    showCard.classList.toggle("showmode", bigMode);

    // Fav button label
    toggleFavBtn.textContent = (isFav(idx) ? "â­ ì¦ê²¨ì°¾ê¸° í•´ì œ" : "â­ ì¦ê²¨ì°¾ê¸°");
    overlayEl.classList.add("show");
    overlayEl.setAttribute("aria-hidden","false");

    // TTS availability note
    const voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
    const hasTTS = !!window.speechSynthesis && voices.length > 0;
    ttsNote.textContent = hasTTS
      ? "ğŸ”Š ì•ˆë‚´: ê¸°ê¸°ì— ë² íŠ¸ë‚¨ì–´ ìŒì„±ì´ ìˆìœ¼ë©´ ì½ì–´ì¤ë‹ˆë‹¤. (ê¸°ê¸°/ë¸Œë¼ìš°ì €ì— ë”°ë¼ ì•ˆ ë  ìˆ˜ ìˆì–´ìš”)"
      : "ğŸ”Š ì•ˆë‚´: ì´ ê¸°ê¸°ì—ì„œ ìŒì„± ì½ê¸° ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”. (ë¬¸ì¥ í‘œì‹œëŠ” ì •ìƒ ë™ì‘)";
  }

  function closeModalFn(){
    overlayEl.classList.remove("show");
    overlayEl.setAttribute("aria-hidden","true");
    currentIdx = -1;
    if (window.speechSynthesis) window.speechSynthesis.cancel();
  }

  closeModal.onclick = () => { vibrate(); closeModalFn(); };
  overlayEl.addEventListener("click", (e) => {
    if (e.target === overlayEl) { vibrate(); closeModalFn(); }
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && overlayEl.classList.contains("show")) closeModalFn();
  });

  toggleFavBtn.onclick = () => {
    if (currentIdx < 0) return;
    vibrate();
    toggleFav(currentIdx);
    toggleFavBtn.textContent = (isFav(currentIdx) ? "â­ ì¦ê²¨ì°¾ê¸° í•´ì œ" : "â­ ì¦ê²¨ì°¾ê¸°");
    renderGrid();
    toast(isFav(currentIdx) ? "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" : "ì¦ê²¨ì°¾ê¸° í•´ì œ");
  };

  copyAllBtn.onclick = async () => {
    if (currentIdx < 0) return;
    vibrate();
    const p = PHRASES[currentIdx];
    const text = `KR: ${p.ko}\nVI: ${p.vi}\nEN: ${p.en}`;
    try{
      await navigator.clipboard.writeText(text);
      toast("ë³µì‚¬ ì™„ë£Œ");
    }catch{
      toast("ë³µì‚¬ ì‹¤íŒ¨");
    }
  };

  fullscreenBtn.onclick = async () => {
    vibrate();
    try{
      if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
      else await document.exitFullscreen();
    }catch{
      // ignore
    }
  };

  function pickVietnameseVoice(){
    if (!window.speechSynthesis) return null;
    const voices = window.speechSynthesis.getVoices();
    // ìš°ì„ ìˆœìœ„: vi-VN, Vietnamese, "vi"
    return voices.find(v => (v.lang||"").toLowerCase().startsWith("vi"))
      || voices.find(v => (v.name||"").toLowerCase().includes("vietnam"))
      || null;
  }

  speakViBtn.onclick = () => {
    if (currentIdx < 0) return;
    vibrate();
    if (!window.speechSynthesis) { toast("ì´ ê¸°ê¸°ì—ì„œ TTS ë¶ˆê°€"); return; }
    const p = PHRASES[currentIdx];
    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(p.vi);
    const v = pickVietnameseVoice();
    if (v) u.voice = v;
    u.lang = v?.lang || "vi-VN";
    u.rate = 0.95; u.pitch = 1.0;

    try{
      window.speechSynthesis.speak(u);
      toast("ì½ëŠ” ì¤‘â€¦");
    }catch{
      toast("TTS ì‹¤íŒ¨");
    }
  };

  // Settings toggles
  onlyFavEl.checked = onlyFav;
  bigModeEl.checked = bigMode;

  onlyFavEl.onchange = () => {
    vibrate();
    onlyFav = !!onlyFavEl.checked;
    localStorage.setItem(LS_ONLYFAV, onlyFav ? "1" : "0");
    // ì¦ê²¨ì°¾ê¸° ì¹´í…Œê³ ë¦¬ì¼ ë• ë¬´ì˜ë¯¸í•˜ì§€ë§Œ ìœ ì§€
    renderGrid();
  };

  bigModeEl.onchange = () => {
    vibrate();
    bigMode = !!bigModeEl.checked;
    localStorage.setItem(LS_BIG, bigMode ? "1" : "0");
    if (overlayEl.classList.contains("show")){
      showCard.classList.toggle("showmode", bigMode);
    }
  };

  // Search
  searchEl.addEventListener("input", () => {
    searchText = searchEl.value || "";
    renderGrid();
  });
  clearSearchEl.onclick = () => {
    vibrate();
    searchEl.value = "";
    searchText = "";
    renderGrid();
    searchEl.focus();
  };

  // Make sure voices load on some Android devices
  if (window.speechSynthesis){
    window.speechSynthesis.onvoiceschanged = () => {};
  }

  // Default: if "fav" selected but empty, switch to greet
  if (selectedCat === "fav" && favorites.size === 0) selectedCat = "greet";

  renderTabs();
  renderGrid();

  // Service worker
  if ("serviceWorker" in navigator){
    window.addEventListener("load", async () => {
      try{
        await navigator.serviceWorker.register("./sw.js");
      }catch(e){
        // ignore
      }
    });
  }
})();
</script>
</body>
</html>
