<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <!-- ì‹œìŠ¤í…œ ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œì— ë§ì¶° ì£¼ì†Œì°½ ìƒ‰ë„ ë³€ê²½ -->
  <meta name="theme-color" content="#f5f5f7" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#0f0f12" media="(prefers-color-scheme: dark)" />

  <title>ë² íŠ¸ë‚¨ ì—¬í–‰ ë²„íŠ¼ ëŒ€í™”</title>
  <link rel="manifest" href="manifest.webmanifest">

  <style>
    /* ê¸°ë³¸: ë¼ì´íŠ¸ ëª¨ë“œ */
    :root{
      --bg:#f5f5f7;
      --card:#ffffff;
      --card2:#f0f1f4;
      --text:#111217;
      --muted:#5a6072;
      --border: rgba(0,0,0,0.10);

      --accent:#0284c7;
      --good:#059669;
      --danger:#e11d48;

      --radius:18px;
      --shadow: 0 14px 40px rgba(0,0,0,0.10);
    }

    /* ì‹œìŠ¤í…œ ë‹¤í¬ ëª¨ë“œ */
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f0f12;
        --card:#17171c;
        --card2:#1f1f26;
        --text:#f5f5f7;
        --muted:#b9bbc6;
        --border: rgba(255,255,255,0.12);

        --accent:#7dd3fc;
        --good:#34d399;
        --danger:#fb7185;

        --shadow: 0 20px 60px rgba(0,0,0,0.55);
      }
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-tap-highlight-color: transparent;
    }

    .app{
      min-height:100svh;
      display:flex;
      flex-direction:column;
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
      gap:10px;
    }

    header{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 8px 2px 8px;
    }

    .title{
      font-size:20px;
      font-weight:900;
      letter-spacing:-0.3px;
      line-height:1.1;
    }
    .subtitle{
      font-size:13px;
      color:var(--muted);
      margin-top:2px;
      font-weight:700;
    }

    /* êµ¬ê¸€ ì‚¬ì§„ ë²ˆì—­ ë²„íŠ¼ */
    .top-actions{
      padding:0 6px 2px 6px;
    }
    .photo-btn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:14px 14px;
      border-radius:18px;
      border:1px solid var(--border);
      background:linear-gradient(180deg, var(--card), var(--card2));
      color:var(--text);
      font-size:16px;
      font-weight:1000;
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }
    .photo-btn:active{transform:translateY(1px)}
    .photo-btn .small{
      font-size:12px;
      font-weight:800;
      color:var(--muted);
    }

    .tabs{
      display:flex;
      gap:10px;
      overflow:auto;
      padding:6px;
      scroll-snap-type:x mandatory;
    }
    .tab{
      scroll-snap-align:start;
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:8px;
      background:var(--card);
      border:1px solid var(--border);
      padding:14px 14px;
      border-radius:999px;
      font-size:16px;
      font-weight:900;
      color:var(--text);
      user-select:none;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }
    .tab.active{
      outline:2px solid color-mix(in srgb, var(--accent), transparent 55%);
      border-color: color-mix(in srgb, var(--accent), transparent 55%);
    }

    main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:0 6px 6px 6px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media (min-width: 540px){
      .grid{grid-template-columns:1fr 1fr}
    }

    .btn{
      background:linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px 16px;
      text-align:left;
      color:var(--text);
      font-size:18px;
      font-weight:1000;
      line-height:1.15;
      cursor:pointer;
      position:relative;
      min-height:72px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }
    .btn .hint{
      display:block;
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      line-height:1.25;
    }
    .btn:active{transform:translateY(1px)}

    .btn .star{
      position:absolute;
      right:12px;
      top:12px;
      width:44px;
      height:44px;
      display:grid;
      place-items:center;
      border-radius:12px;
      background: color-mix(in srgb, var(--card), transparent 10%);
      border:1px solid var(--border);
      font-size:20px;
    }

    /* Modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:12px;
      z-index:50;
    }
    @media (prefers-color-scheme: light){
      .overlay{ background: rgba(0,0,0,0.35); }
    }
    .overlay.show{display:flex}

    .modal{
      width:min(720px, 100%);
      background:linear-gradient(180deg, var(--card), var(--bg));
      border:1px solid var(--border);
      border-radius:22px;
      overflow:hidden;
      box-shadow: var(--shadow);
    }

    .modal-header{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      background: color-mix(in srgb, var(--card), transparent 4%);
      border-bottom:1px solid var(--border);
    }
    .modal-header .kocat{
      font-weight:1000;
      font-size:14px;
      color:var(--muted);
      letter-spacing:0.2px;
    }
    .modal-header .close{
      margin-left:auto;
      background: color-mix(in srgb, var(--card2), transparent 0%);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      font-size:16px;
      font-weight:1000;
      color:var(--text);
      min-width:76px;
    }

    .modal-body{
      padding:14px 14px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .card{
      background: color-mix(in srgb, var(--card2), transparent 0%);
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
    }
    .label{
      font-size:13px;
      color:var(--muted);
      font-weight:1000;
      margin-bottom:8px;
    }
    .ko{
      font-size:18px;
      font-weight:1000;
      line-height:1.2;
    }

    .vi{
      margin-top:10px;
      font-size:38px;
      font-weight:1100;
      line-height:1.12;
      letter-spacing:-0.2px;
    }
    .en{
      margin-top:8px;
      font-size:18px;
      font-weight:950;
      color: color-mix(in srgb, var(--text), transparent 8%);
    }
    .enpron{
      margin-top:10px;
      font-size:16px;
      font-weight:950;
      color: color-mix(in srgb, var(--text), transparent 12%);
      line-height:1.25;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .actions button{
      flex:1;
      min-width:140px;
      background: color-mix(in srgb, var(--card2), transparent 0%);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px 14px;
      font-size:16px;
      font-weight:1100;
      color:var(--text);
    }
    .actions button.primary{
      outline:2px solid color-mix(in srgb, var(--accent), transparent 55%);
      border-color: color-mix(in srgb, var(--accent), transparent 55%);
    }
    .actions button.good{
      outline:2px solid color-mix(in srgb, var(--good), transparent 60%);
      border-color: color-mix(in srgb, var(--good), transparent 65%);
    }
    .actions button.danger{
      outline:2px solid color-mix(in srgb, var(--danger), transparent 70%);
      border-color: color-mix(in srgb, var(--danger), transparent 75%);
    }

    .note{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      font-weight:750;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.78);
      border:1px solid rgba(255,255,255,0.12);
      color:#fff;
      padding:12px 14px;
      border-radius:999px;
      font-size:14px;
      font-weight:1000;
      display:none;
      z-index:60;
    }
    @media (prefers-color-scheme: light){
      .toast{
        background: rgba(0,0,0,0.78);
        border: 1px solid rgba(255,255,255,0.18);
      }
    }
    .toast.show{display:block}
  </style>
</head>

<body>
  <div class="app" id="app">
    <header>
      <div>
        <div class="title">ë² íŠ¸ë‚¨ ì—¬í–‰ ë²„íŠ¼ ëŒ€í™”</div>
        <div class="subtitle">ë¬¸ì¥ ë²„íŠ¼ â†’ ë² íŠ¸ë‚¨ì–´ í° ê¸€ì”¨ â†’ ìƒëŒ€ì—ê²Œ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”</div>
      </div>
    </header>

    <!-- êµ¬ê¸€ ì‚¬ì§„ ë²ˆì—­ ë²„íŠ¼(ì¶”ê°€) -->
    <div class="top-actions">
      <button class="photo-btn" id="photoTranslateBtn" type="button">
        ğŸ“· êµ¬ê¸€ ë²ˆì—­ ì—´ê¸°
        <span class="small">(ë©”ë‰´/í‘œì§€íŒ ì´¬ì˜)</span>
      </button>
    </div>

    <div class="tabs" id="tabs"></div>

    <main>
      <div class="grid" id="grid"></div>
      <div class="note" style="padding:0 6px;">
        â€¢ â­ ì¦ê²¨ì°¾ê¸°: ëª©ë¡ì˜ ë³„(â­)ì„ ëˆŒëŸ¬ ì €ì¥í•˜ê±°ë‚˜, ë¬¸ì¥ í™”ë©´ì—ì„œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        â€¢ ğŸ”Š ìŒì„±: ê¸°ê¸°/ë¸Œë¼ìš°ì €ê°€ ë² íŠ¸ë‚¨ì–´ ìŒì„±ì„ ì§€ì›í•  ë•Œë§Œ ì¬ìƒë©ë‹ˆë‹¤.<br>
        â€¢ ğŸ“· ì‚¬ì§„ ë²ˆì—­: êµ¬ê¸€ ë²ˆì—­ ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì•±ì„ ì—´ê³ , ì—†ìœ¼ë©´ í”Œë ˆì´ìŠ¤í† ì–´ë¡œ ì´ë™í•©ë‹ˆë‹¤(ì¸í„°ë„· í•„ìš”).
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div class="kocat" id="modalCat"></div>
        <button class="close" id="closeModal">ë‹«ê¸°</button>
      </div>

      <div class="modal-body">
        <div class="card">
          <div class="label">í•œêµ­ì–´</div>
          <div class="ko" id="mKo"></div>
        </div>

        <div class="card">
          <div class="label">ë² íŠ¸ë‚¨ì–´ (ìƒëŒ€ì—ê²Œ ë³´ì—¬ì£¼ê¸°)</div>
          <div class="vi" id="mVi"></div>
          <div class="enpron" id="mEnPron"></div>
          <div class="en" id="mEn"></div>
        </div>

        <div class="actions">
          <button class="good" id="toggleFav">â­ ì¦ê²¨ì°¾ê¸°</button>
          <button class="primary" id="speakVi">ğŸ”Š ë² íŠ¸ë‚¨ì–´ ì½ê¸°</button>
          <button class="danger" id="fullscreen">ğŸ”† í™”ë©´ ìµœëŒ€</button>
        </div>

        <div class="note" id="ttsNote"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const CATS = [
    { key:"fav", icon:"â­", name:"ì¦ê²¨ì°¾ê¸°" },
    { key:"greet", icon:"ğŸ‘‹", name:"ì¸ì‚¬" },
    { key:"basic", icon:"ğŸ§­", name:"ê¸°ë³¸" },
    { key:"airport", icon:"âœˆï¸", name:"ê³µí•­" },
    { key:"hotel", icon:"ğŸ¨", name:"ìˆ™ì†Œ/ì˜ˆì•½" },
    { key:"transport", icon:"ğŸš•", name:"êµí†µ" },
    { key:"food", icon:"ğŸœ", name:"ì‹ë‹¹" },
    { key:"money", icon:"ğŸ’³", name:"ê°€ê²©/ê²°ì œ" },
    { key:"help", icon:"ğŸ†˜", name:"ê¸´ê¸‰" }
  ];

  // ë¬¸ì¥ ë°ì´í„°
  // enPron: ì˜ì–´ ë°œìŒ(í•œêµ­ì–´ í‘œê¸°) - 'ëŒ€ì¶© ì½ê¸°' ìˆ˜ì¤€ì˜ ì•ˆë‚´ì…ë‹ˆë‹¤.
  const PHRASES = [
    // ì¸ì‚¬
    {cat:"greet", ko:"ì•ˆë…•í•˜ì„¸ìš”.", vi:"Xin chÃ o.", en:"Hello.", enPron:"í—¬ë¡œ"},
    {cat:"greet", ko:"ê°ì‚¬í•©ë‹ˆë‹¤.", vi:"Cáº£m Æ¡n.", en:"Thank you.", enPron:"ë•¡í"},
    {cat:"greet", ko:"ì£„ì†¡í•©ë‹ˆë‹¤.", vi:"Xin lá»—i.", en:"Sorry / Excuse me.", enPron:"ì˜ë¦¬ / ìµìŠ¤íì¦ˆ ë¯¸"},
    {cat:"greet", ko:"ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”.", vi:"ChÃºc báº¡n má»™t ngÃ y tá»‘t lÃ nh.", en:"Have a nice day.", enPron:"í•´ë¸Œ ì–´ ë‚˜ì´ìŠ¤ ë°ì´"},
    {cat:"greet", ko:"ë„ì™€ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.", vi:"Cáº£m Æ¡n báº¡n Ä‘Ã£ giÃºp tÃ´i.", en:"Thank you for helping me.", enPron:"ë•¡í í¬ í—¬í•‘ ë¯¸"},

    // ê¸°ë³¸
    {cat:"basic", ko:"í•œêµ­ ì‚¬ëŒì…ë‹ˆë‹¤.", vi:"TÃ´i lÃ  ngÆ°á»i HÃ n Quá»‘c.", en:"Iâ€™m Korean.", enPron:"ì•„ì„ ì½”ë¦¬ì–¸"},
    {cat:"basic", ko:"ì˜ì–´/ë² íŠ¸ë‚¨ì–´ë¥¼ ëª»í•©ë‹ˆë‹¤. ì²œì²œíˆ ë§í•´ ì£¼ì„¸ìš”.", vi:"TÃ´i khÃ´ng nÃ³i Ä‘Æ°á»£c tiáº¿ng Anh/tiáº¿ng Viá»‡t. Vui lÃ²ng nÃ³i cháº­m.", en:"I canâ€™t speak English/Vietnamese. Please speak slowly.", enPron:"ì•„ì´ ìº”íŠ¸ ìŠ¤í”¼í¬ ì‰ê¸€ë¦¬ì‹œ/ë¹„ì—íŠ¸ë‚˜ë¯¸ì¦ˆ. í”Œë¦¬ì¦ˆ ìŠ¤í”¼í¬ ìŠ¬ë¡œìš¸ë¦¬"},
    {cat:"basic", ko:"ë‹¤ì‹œ í•œ ë²ˆ ë§í•´ ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng nÃ³i láº¡i.", en:"Please say it again.", enPron:"í”Œë¦¬ì¦ˆ ì„¸ì´ ì‡ ì–´ê²Œì¸"},
    {cat:"basic", ko:"ì´ê±¸ë¡œ ê´œì°®ë‚˜ìš”?", vi:"NhÆ° váº­y Ä‘Æ°á»£c khÃ´ng?", en:"Is this okay?", enPron:"ì´ì¦ˆ ë””ìŠ¤ ì˜¤ì¼€ì´?"},
    {cat:"basic", ko:"í™”ì¥ì‹¤ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"NhÃ  vá»‡ sinh á»Ÿ Ä‘Ã¢u?", en:"Where is the restroom?", enPron:"ì›¨ì–´ ì´ì¦ˆ ë” ë ˆìŠ¤íŠ¸ë£¸?"},
    {cat:"basic", ko:"ì—¬ê¸° ì¢€ ë„ì™€ì£¼ì„¸ìš”.", vi:"GiÃºp tÃ´i vá»›i, lÃ m Æ¡n.", en:"Please help me here.", enPron:"í”Œë¦¬ì¦ˆ í—¬í”„ ë¯¸ íˆì–´"},
    {cat:"basic", ko:"ì‚¬ì§„ ì°ì–´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", vi:"Báº¡n cÃ³ thá»ƒ chá»¥p áº£nh giÃºp tÃ´i khÃ´ng?", en:"Could you take a photo for me?", enPron:"ì¿ ë“œ ìœ  í…Œì´í¬ ì–´ í¬í†  í¬ ë¯¸?"},
    {cat:"basic", ko:"ì´ ì£¼ì†Œë¡œ ê°€ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n Ä‘áº¿n Ä‘á»‹a chá»‰ nÃ y.", en:"I want to go to this address.", enPron:"ì•„ì´ ì›íŠ¸ íˆ¬ ê³  íˆ¬ ë””ìŠ¤ ì–´ë“œë ˆìŠ¤"},

    // ê³µí•­
    {cat:"airport", ko:"ì¶œêµ­ì¥(ì²´í¬ì¸)ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Khu lÃ m thá»§ tá»¥c (check-in) á»Ÿ Ä‘Ã¢u?", en:"Where is the check-in area?", enPron:"ì›¨ì–´ ì´ì¦ˆ ë” ì²´í¬ì¸ ì—ì–´ë¦¬ì–´?"},
    {cat:"airport", ko:"ìˆ˜í•˜ë¬¼ ì°¾ëŠ” ê³³ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Khu nháº­n hÃ nh lÃ½ á»Ÿ Ä‘Ã¢u?", en:"Where is baggage claim?", enPron:"ì›¨ì–´ ì´ì¦ˆ ë°°ê¸°ì§€ í´ë ˆì„?"},
    {cat:"airport", ko:"í™˜ì „ì†ŒëŠ” ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Quáº§y Ä‘á»•i tiá»n á»Ÿ Ä‘Ã¢u?", en:"Where is the currency exchange?", enPron:"ì›¨ì–´ ì´ì¦ˆ ë” ì»¤ëŸ°ì‹œ ìµìŠ¤ì²´ì¸ì§€?"},
    {cat:"airport", ko:"íƒì‹œ íƒ€ëŠ” ê³³ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"Chá»— báº¯t taxi á»Ÿ Ä‘Ã¢u?", en:"Where can I get a taxi?", enPron:"ì›¨ì–´ ìº” ì•„ì´ ê²Ÿ ì–´ íƒì‹œ?"},
    {cat:"airport", ko:"ì´ í•­ê³µí¸ì´ ë§ë‚˜ìš”? í™•ì¸í•´ì£¼ì„¸ìš”.", vi:"ÄÃ¢y cÃ³ Ä‘Ãºng chuyáº¿n bay khÃ´ng? Vui lÃ²ng kiá»ƒm tra.", en:"Is this the right flight? Please check.", enPron:"ì´ì¦ˆ ë””ìŠ¤ ë” ë¼ì´íŠ¸ í”Œë¼ì´íŠ¸? í”Œë¦¬ì¦ˆ ì²´í¬"},

    // ìˆ™ì†Œ/ì˜ˆì•½
    {cat:"hotel", ko:"ì˜ˆì•½í–ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ì£¼ì„¸ìš”.", vi:"TÃ´i Ä‘Ã£ Ä‘áº·t phÃ²ng. Vui lÃ²ng kiá»ƒm tra giÃºp tÃ´i.", en:"I have a reservation. Please check.", enPron:"ì•„ì´ í•´ë¸Œ ì–´ ë ˆì €ë² ì´ì…˜. í”Œë¦¬ì¦ˆ ì²´í¬"},
    {cat:"hotel", ko:"ì²´í¬ì¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n lÃ m thá»§ tá»¥c nháº­n phÃ²ng.", en:"Iâ€™d like to check in.", enPron:"ì•„ì´ë“œ ë¼ì´í¬ íˆ¬ ì²´í¬ì¸"},
    {cat:"hotel", ko:"ì²´í¬ì•„ì›ƒí•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n tráº£ phÃ²ng.", en:"Iâ€™d like to check out.", enPron:"ì•„ì´ë“œ ë¼ì´í¬ íˆ¬ ì²´í¬ì•„ì›ƒ"},
    {cat:"hotel", ko:"ë°© í‚¤ê°€ ì•ˆ ë©ë‹ˆë‹¤.", vi:"Tháº» phÃ²ng khÃ´ng dÃ¹ng Ä‘Æ°á»£c.", en:"The room key card doesnâ€™t work.", enPron:"ë” ë£¸ í‚¤ ì¹´ë“œ ë”ì¦ŒíŠ¸ ì›Œí¬"},
    {cat:"hotel", ko:"ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ê°€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", vi:"Máº­t kháº©u Wi-Fi lÃ  gÃ¬?", en:"What is the Wi-Fi password?", enPron:"ì™“ ì´ì¦ˆ ë” ì™€ì´íŒŒì´ íŒ¨ìŠ¤ì›Œë“œ?"},
    {cat:"hotel", ko:"ìˆ˜ê±´ì„ ë” ì£¼ì„¸ìš”.", vi:"Cho tÃ´i thÃªm khÄƒn táº¯m, lÃ m Æ¡n.", en:"Please give me more towels.", enPron:"í”Œë¦¬ì¦ˆ ê¸°ë¸Œ ë¯¸ ëª¨ì–´ íƒ€ì›”ì¦ˆ"},
    {cat:"hotel", ko:"ë°© ì²­ì†Œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.", vi:"Vui lÃ²ng dá»n phÃ²ng giÃºp tÃ´i.", en:"Please clean the room.", enPron:"í”Œë¦¬ì¦ˆ í´ë¦° ë” ë£¸"},
    {cat:"hotel", ko:"ì—ì–´ì»¨ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", vi:"MÃ¡y láº¡nh khÃ´ng hoáº¡t Ä‘á»™ng.", en:"The air conditioner doesnâ€™t work.", enPron:"ë”” ì—ì–´ ì»¨ë””ì…”ë„ˆ ë”ì¦ŒíŠ¸ ì›Œí¬"},

    // êµí†µ
    {cat:"transport", ko:"ê³µí•­ìœ¼ë¡œ ê°€ì£¼ì„¸ìš”.", vi:"LÃ m Æ¡n Ä‘Æ°a tÃ´i Ä‘áº¿n sÃ¢n bay.", en:"Please take me to the airport.", enPron:"í”Œë¦¬ì¦ˆ í…Œì´í¬ ë¯¸ íˆ¬ ë”” ì—ì–´í¬íŠ¸"},
    {cat:"transport", ko:"í˜¸í…”(ë¦¬ì¡°íŠ¸)ë¡œ ê°€ì£¼ì„¸ìš”.", vi:"LÃ m Æ¡n Ä‘Æ°a tÃ´i Ä‘áº¿n khÃ¡ch sáº¡n / khu nghá»‰ dÆ°á»¡ng.", en:"Please take me to the hotel / resort.", enPron:"í”Œë¦¬ì¦ˆ í…Œì´í¬ ë¯¸ íˆ¬ ë” í˜¸í…” / ë¦¬ì¡°íŠ¸"},
    {cat:"transport", ko:"ì—¬ê¸°ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xuá»‘ng á»Ÿ Ä‘Ã¢y.", en:"Please drop me off here.", enPron:"í”Œë¦¬ì¦ˆ ë“œë¡­ ë¯¸ ì˜¤í”„ íˆì–´"},
    {cat:"transport", ko:"ì²œì²œíˆ ê°€ì£¼ì„¸ìš”.", vi:"Äi cháº­m thÃ´i.", en:"Please go slowly.", enPron:"í”Œë¦¬ì¦ˆ ê³  ìŠ¬ë¡œìš¸ë¦¬"},
    {cat:"transport", ko:"ë¯¸í„°ê¸°ë¥¼ ì¼œì£¼ì„¸ìš”.", vi:"Vui lÃ²ng báº­t Ä‘á»“ng há»“ tÃ­nh tiá»n.", en:"Please turn on the meter.", enPron:"í”Œë¦¬ì¦ˆ í„´ ì˜¨ ë” ë¯¸í„°"},
    {cat:"transport", ko:"ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?", vi:"Máº¥t bao lÃ¢u?", en:"How long will it take?", enPron:"í•˜ìš° ë¡± ìœŒ ì‡ í…Œì´í¬?"},
    {cat:"transport", ko:"ì—¬ê¸°ê°€ ë§ë‚˜ìš”?", vi:"ÄÃºng chá»— nÃ y khÃ´ng?", en:"Is this the right place?", enPron:"ì´ì¦ˆ ë””ìŠ¤ ë” ë¼ì´íŠ¸ í”Œë ˆì´ìŠ¤?"},
    {cat:"transport", ko:"ì •ì§€í•´ ì£¼ì„¸ìš”.", vi:"Dá»«ng láº¡i, lÃ m Æ¡n.", en:"Please stop.", enPron:"í”Œë¦¬ì¦ˆ ìŠ¤íƒ‘"},

    // ì‹ë‹¹
    {cat:"food", ko:"ë©”ë‰´ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xem thá»±c Ä‘Æ¡n, lÃ m Æ¡n.", en:"Menu, please.", enPron:"ë©”ë‰´, í”Œë¦¬ì¦ˆ"},
    {cat:"food", ko:"ì´ê±° ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i mÃ³n nÃ y.", en:"Iâ€™d like to order this.", enPron:"ì•„ì´ë“œ ë¼ì´í¬ íˆ¬ ì˜¤ë” ë””ìŠ¤"},
    {cat:"food", ko:"ë¬¼ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i nÆ°á»›c, lÃ m Æ¡n.", en:"Water, please.", enPron:"ì›Œí„°, í”Œë¦¬ì¦ˆ"},
    {cat:"food", ko:"ì½œë¼ë¥¼ ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i Coca.", en:"Iâ€™d like to order a Coke.", enPron:"ì•„ì´ë“œ ë¼ì´í¬ íˆ¬ ì˜¤ë” ì–´ ì½”í¬"},
    {cat:"food", ko:"ë§¥ì£¼ë¥¼ ì£¼ë¬¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.", vi:"TÃ´i muá»‘n gá»i bia.", en:"Iâ€™d like to order beer.", enPron:"ì•„ì´ë“œ ë¼ì´í¬ íˆ¬ ì˜¤ë” ë¹„ì–´"},
    {cat:"food", ko:"ê³ ìˆ˜ë¥¼ ë¹¼ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng khÃ´ng cho rau mÃ¹i.", en:"Please donâ€™t add cilantro.", enPron:"í”Œë¦¬ì¦ˆ ëˆíŠ¸ ì• ë“œ ì‹¤ë€íŠ¸ë¡œ"},
    {cat:"food", ko:"ëœ ë§µê²Œ í•´ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng lÃ m Ã­t cay.", en:"Please make it less spicy.", enPron:"í”Œë¦¬ì¦ˆ ë©”ì´í¬ ì‡ ë ˆìŠ¤ ìŠ¤íŒŒì´ì‹œ"},
    {cat:"food", ko:"ë§¤ìš´ ê±° ë¹¼ì£¼ì„¸ìš”.", vi:"Vui lÃ²ng khÃ´ng cho á»›t.", en:"Please donâ€™t add chili.", enPron:"í”Œë¦¬ì¦ˆ ëˆíŠ¸ ì• ë“œ ì¹ ë¦¬"},
    {cat:"food", ko:"ê³¼ì¼ì´ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ trÃ¡i cÃ¢y khÃ´ng?", en:"Do you have fruit?", enPron:"ë‘ ìœ  í•´ë¸Œ í”„ë£»?"},
    {cat:"food", ko:"ì±„ì‹ ë©”ë‰´ê°€ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ mÃ³n chay khÃ´ng?", en:"Do you have vegetarian food?", enPron:"ë‘ ìœ  í•´ë¸Œ ë² ì§€í…Œë¦¬ì–¸ í‘¸ë“œ?"},
    {cat:"food", ko:"í¬ì¥í•´ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i mang vá», lÃ m Æ¡n.", en:"To go, please.", enPron:"íˆ¬ ê³ , í”Œë¦¬ì¦ˆ"},
    {cat:"food", ko:"ê³„ì‚°ì„œ ì£¼ì„¸ìš”.", vi:"TÃ­nh tiá»n, lÃ m Æ¡n.", en:"Bill, please.", enPron:"ë¹Œ, í”Œë¦¬ì¦ˆ"},
    {cat:"food", ko:"ì¹´ë“œë¡œ ê²°ì œí•  ìˆ˜ ìˆë‚˜ìš”?", vi:"TÃ´i cÃ³ thá»ƒ thanh toÃ¡n báº±ng tháº» khÃ´ng?", en:"Can I pay by card?", enPron:"ìº” ì•„ì´ í˜ì´ ë°”ì´ ì¹´ë“œ?"},
    {cat:"food", ko:"ê³ ì¶”ì¥ ìˆìŠµë‹ˆê¹Œ?", vi:"CÃ³ gochujang khÃ´ng?", en:"Do you have gochujang?", enPron:"ë‘ ìœ  í•´ë¸Œ ê³ ì¶”ì¥?"},

    // ê°€ê²©/ê²°ì œ
    {cat:"money", ko:"ì–¼ë§ˆì…ë‹ˆê¹Œ?", vi:"Bao nhiÃªu tiá»n?", en:"How much is it?", enPron:"í•˜ìš° ë¨¸ì¹˜ ì´ì¦ˆ ì‡?"},
    {cat:"money", ko:"ì¢€ ê¹ì•„ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", vi:"Báº¡n cÃ³ thá»ƒ giáº£m giÃ¡ má»™t chÃºt khÃ´ng?", en:"Can you give me a discount?", enPron:"ìº” ìœ  ê¸°ë¸Œ ë¯¸ ì–´ ë””ìŠ¤ì¹´ìš´íŠ¸?"},
    {cat:"money", ko:"ì´ê±° 2ê°œ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i 2 cÃ¡i nÃ y.", en:"Two of these, please.", enPron:"íˆ¬ ì˜¤ë¸Œ ë””ì¦ˆ, í”Œë¦¬ì¦ˆ"},
    {cat:"money", ko:"ì˜ìˆ˜ì¦ ì£¼ì„¸ìš”.", vi:"Cho tÃ´i xin hÃ³a Ä‘Æ¡n.", en:"Please give me a receipt.", enPron:"í”Œë¦¬ì¦ˆ ê¸°ë¸Œ ë¯¸ ì–´ ë¦¬ì‹¯"},
    {cat:"money", ko:"í˜„ê¸ˆìœ¼ë¡œ ê²°ì œí• ê²Œìš”.", vi:"TÃ´i sáº½ tráº£ báº±ng tiá»n máº·t.", en:"I will pay in cash.", enPron:"ì•„ì´ ìœŒ í˜ì´ ì¸ ìºì‹œ"},
    {cat:"money", ko:"ì¹´ë“œë¡œ ê²°ì œí• ê²Œìš”.", vi:"TÃ´i sáº½ tráº£ báº±ng tháº».", en:"I will pay by card.", enPron:"ì•„ì´ ìœŒ í˜ì´ ë°”ì´ ì¹´ë“œ"},

    // ê¸´ê¸‰
    {cat:"help", ko:"ë„ì™€ì£¼ì„¸ìš”!", vi:"GiÃºp tÃ´i vá»›i!", en:"Help me!", enPron:"í—¬í”„ ë¯¸!"},
    {cat:"help", ko:"ê¸¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤.", vi:"TÃ´i bá»‹ láº¡c.", en:"Iâ€™m lost.", enPron:"ì•„ì„ ë¡œìŠ¤íŠ¸"},
    {cat:"help", ko:"ê²½ì°°ì„ ë¶ˆëŸ¬ì£¼ì„¸ìš”.", vi:"Gá»i cáº£nh sÃ¡t giÃºp tÃ´i.", en:"Please call the police.", enPron:"í”Œë¦¬ì¦ˆ ì½œ ë” í´ë¦¬ìŠ¤"},
    {cat:"help", ko:"ë³‘ì›ì— ê°€ì•¼ í•©ë‹ˆë‹¤.", vi:"TÃ´i cáº§n Ä‘áº¿n bá»‡nh viá»‡n.", en:"I need to go to the hospital.", enPron:"ì•„ì´ ë‹ˆë“œ íˆ¬ ê³  íˆ¬ ë” í•˜ìŠ¤í”¼í„¸"},
    {cat:"help", ko:"ì•½êµ­ì€ ì–´ë””ì…ë‹ˆê¹Œ?", vi:"NhÃ  thuá»‘c á»Ÿ Ä‘Ã¢u?", en:"Where is the pharmacy?", enPron:"ì›¨ì–´ ì´ì¦ˆ ë” íŒŒë¨¸ì‹œ?"},
    {cat:"help", ko:"íœ´ëŒ€í°ì„ ìƒì–´ë²„ë ¸ìŠµë‹ˆë‹¤.", vi:"TÃ´i bá»‹ máº¥t Ä‘iá»‡n thoáº¡i.", en:"I lost my phone.", enPron:"ì•„ì´ ë¡œìŠ¤íŠ¸ ë§ˆì´ í°"}
  ];

  // ---- State ----
  const LS_FAV = "vn_btn_fav_v3";
  const LS_CAT = "vn_btn_cat_v3";

  let favorites = new Set(JSON.parse(localStorage.getItem(LS_FAV) || "[]"));
  let selectedCat = localStorage.getItem(LS_CAT) || "greet";

  // ---- UI refs ----
  const tabsEl = $("tabs");
  const gridEl = $("grid");
  const overlayEl = $("overlay");
  const modalCat = $("modalCat");
  const closeModal = $("closeModal");
  const toggleFavBtn = $("toggleFav");
  const speakViBtn = $("speakVi");
  const fullscreenBtn = $("fullscreen");
  const ttsNote = $("ttsNote");
  const toastEl = $("toast");

  const mKo = $("mKo");
  const mVi = $("mVi");
  const mEnPron = $("mEnPron");
  const mEn = $("mEn");

  const photoTranslateBtn = $("photoTranslateBtn");

  let currentIdx = -1;

  function vibrate(ms=20){
    if (navigator.vibrate) navigator.vibrate(ms);
  }

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1200);
  }

  function isFav(idx){ return favorites.has(String(idx)); }

  function toggleFav(idx){
    const key = String(idx);
    if (favorites.has(key)) favorites.delete(key);
    else favorites.add(key);
    localStorage.setItem(LS_FAV, JSON.stringify([...favorites]));
  }

  function renderTabs(){
    tabsEl.innerHTML = "";
    for (const c of CATS){
      const btn = document.createElement("button");
      btn.className = "tab" + ((c.key===selectedCat) ? " active" : "");
      btn.type = "button";
      btn.textContent = `${c.icon} ${c.name}`;
      btn.onclick = () => {
        vibrate();
        selectedCat = c.key;
        localStorage.setItem(LS_CAT, selectedCat);
        renderTabs();
        renderGrid();
      };
      tabsEl.appendChild(btn);
    }
  }

  function getVisibleItems(){
    if (selectedCat === "fav"){
      const out = [];
      PHRASES.forEach((p, i) => { if (isFav(i)) out.push({p, i}); });
      return out;
    }

    const out = [];
    PHRASES.forEach((p, i) => {
      if (p.cat !== selectedCat) return;
      out.push({p, i});
    });
    return out;
  }

  function renderGrid(){
    const items = getVisibleItems();
    gridEl.innerHTML = "";

    if (items.length === 0){
      const empty = document.createElement("div");
      empty.className = "card";
      empty.innerHTML = `
        <div class="ko" style="font-size:18px;">í‘œì‹œí•  ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        <div class="note" style="margin-top:8px;">â€¢ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê±°ë‚˜, ë³„(â­)ì„ ëˆŒëŸ¬ ì¦ê²¨ì°¾ê¸°ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</div>
      `;
      gridEl.appendChild(empty);
      return;
    }

    for (const {p, i} of items){
      const b = document.createElement("button");
      b.className = "btn";
      b.type = "button";
      b.innerHTML = `
        <div>${p.ko}</div>
        <span class="hint">${p.vi}</span>
        <div class="star" title="ì¦ê²¨ì°¾ê¸°">${isFav(i) ? "â­" : "â˜†"}</div>
      `;

      b.onclick = (ev) => {
        const starRect = b.querySelector(".star").getBoundingClientRect();
        const x = ev.clientX, y = ev.clientY;
        const isStarClick = x >= starRect.left && x <= starRect.right && y >= starRect.top && y <= starRect.bottom;

        vibrate();
        if (isStarClick){
          toggleFav(i);
          renderGrid();
          toast(isFav(i) ? "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" : "ì¦ê²¨ì°¾ê¸° í•´ì œ");
          return;
        }
        openModal(i);
      };

      gridEl.appendChild(b);
    }
  }

  function openModal(idx){
    currentIdx = idx;
    const p = PHRASES[idx];
    modalCat.textContent = "ì¹´í…Œê³ ë¦¬: " + (CATS.find(c=>c.key===p.cat)?.name || p.cat);

    mKo.textContent = p.ko;
    mVi.textContent = p.vi;
    mEnPron.textContent = "ì˜ì–´ ë°œìŒ: " + (p.enPron || "-");
    mEn.textContent = p.en;

    toggleFavBtn.textContent = (isFav(idx) ? "â­ ì¦ê²¨ì°¾ê¸° í•´ì œ" : "â­ ì¦ê²¨ì°¾ê¸°");

    overlayEl.classList.add("show");
    overlayEl.setAttribute("aria-hidden","false");

    const voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
    const hasTTS = !!window.speechSynthesis && voices.length > 0;
    ttsNote.textContent = hasTTS
      ? "ğŸ”Š ì•ˆë‚´: ê¸°ê¸°ì— ë² íŠ¸ë‚¨ì–´ ìŒì„±ì´ ìˆìœ¼ë©´ ì½ì–´ì¤ë‹ˆë‹¤. (ê¸°ê¸°/ë¸Œë¼ìš°ì €ì— ë”°ë¼ ì•ˆ ë  ìˆ˜ ìˆì–´ìš”)"
      : "ğŸ”Š ì•ˆë‚´: ì´ ê¸°ê¸°ì—ì„œ ìŒì„± ì½ê¸° ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”. (ë¬¸ì¥ í‘œì‹œëŠ” ì •ìƒ ë™ì‘)";
  }

  function closeModalFn(){
    overlayEl.classList.remove("show");
    overlayEl.setAttribute("aria-hidden","true");
    currentIdx = -1;
    if (window.speechSynthesis) window.speechSynthesis.cancel();
  }

  closeModal.onclick = () => { vibrate(); closeModalFn(); };
  overlayEl.addEventListener("click", (e) => {
    if (e.target === overlayEl) { vibrate(); closeModalFn(); }
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && overlayEl.classList.contains("show")) closeModalFn();
  });

  toggleFavBtn.onclick = () => {
    if (currentIdx < 0) return;
    vibrate();
    toggleFav(currentIdx);
    toggleFavBtn.textContent = (isFav(currentIdx) ? "â­ ì¦ê²¨ì°¾ê¸° í•´ì œ" : "â­ ì¦ê²¨ì°¾ê¸°");
    renderGrid();
    toast(isFav(currentIdx) ? "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" : "ì¦ê²¨ì°¾ê¸° í•´ì œ");
  };

  function pickVietnameseVoice(){
    if (!window.speechSynthesis) return null;
    const voices = window.speechSynthesis.getVoices();
    return voices.find(v => (v.lang||"").toLowerCase().startsWith("vi"))
      || voices.find(v => (v.name||"").toLowerCase().includes("vietnam"))
      || null;
  }

  speakViBtn.onclick = () => {
    if (currentIdx < 0) return;
    vibrate();
    if (!window.speechSynthesis) { toast("ì´ ê¸°ê¸°ì—ì„œ TTS ë¶ˆê°€"); return; }
    const p = PHRASES[currentIdx];
    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(p.vi);
    const v = pickVietnameseVoice();
    if (v) u.voice = v;
    u.lang = v?.lang || "vi-VN";
    u.rate = 0.95; u.pitch = 1.0;

    try{
      window.speechSynthesis.speak(u);
      toast("ì½ëŠ” ì¤‘â€¦");
    }catch{
      toast("TTS ì‹¤íŒ¨");
    }
  };

  fullscreenBtn.onclick = async () => {
    vibrate();
    try{
      if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
      else await document.exitFullscreen();
    }catch{
      // ignore
    }
  };

  // ğŸ“· êµ¬ê¸€ ì‚¬ì§„ ë²ˆì—­ ë²„íŠ¼ (ìš”ì²­ ë°˜ì˜)
  // - Google ë²ˆì—­ ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ì•±ì„ ì—´ê³ 
  // - ì—†ìœ¼ë©´ Google ë²ˆì—­ í”Œë ˆì´ìŠ¤í† ì–´ë¡œ ì´ë™
  photoTranslateBtn.onclick = () => {
    vibrate();

    // Google Translate íŒ¨í‚¤ì§€ëª…
    const PLAY_STORE_URL = "https://play.google.com/store/apps/details?id=com.google.android.apps.translate";
    // Android intent: ì•± ì‹¤í–‰ ì‹œë„
    const INTENT_URL =
      "intent://translate/#Intent;scheme=googletranslate;package=com.google.android.apps.translate;end";

    // 1) ì•± ì‹¤í–‰ ì‹œë„
    // 2) ì‹¤íŒ¨í•˜ë©´ ì¼ì • ì‹œê°„ í›„ í”Œë ˆì´ìŠ¤í† ì–´ë¡œ í´ë°±
    let opened = false;

    const start = Date.now();
    const timer = setTimeout(() => {
      if (!opened && (Date.now() - start) < 1800) {
        window.location.href = PLAY_STORE_URL;
      }
    }, 900);

    // ì•±ìœ¼ë¡œ ì „í™˜ë˜ë©´ í˜ì´ì§€ê°€ ìˆ¨ê²¨ì§ â†’ opened ì²˜ë¦¬
    const onVis = () => {
      if (document.hidden) {
        opened = true;
        clearTimeout(timer);
        document.removeEventListener("visibilitychange", onVis);
      }
    };
    document.addEventListener("visibilitychange", onVis);

    // ì¸í…íŠ¸ ì‹¤í–‰
    window.location.href = INTENT_URL;
  };

  // voices load (Android)
  if (window.speechSynthesis){
    window.speechSynthesis.onvoiceschanged = () => {};
  }

  // ì¦ê²¨ì°¾ê¸° íƒ­ì¸ë° ë¹„ì—ˆìœ¼ë©´ ì¸ì‚¬ë¡œ
  if (selectedCat === "fav" && favorites.size === 0) selectedCat = "greet";

  renderTabs();
  renderGrid();

  // Service worker
  if ("serviceWorker" in navigator){
    window.addEventListener("load", async () => {
      try{ await navigator.serviceWorker.register("./sw.js"); }catch(e){}
    });
  }
})();
</script>
</body>
</html>

